---
title: "Computational Musicology"
output: 
  flexdashboard::flex_dashboard:
    storyboard: true
    theme: flatly
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(message = FALSE, echo = FALSE)

library(tidyverse)
library(spotifyr)
library(ggfortify)
library(flexdashboard)
library(readr)
library(lubridate)
library(ggplot2)
library(plotly)

sebas <- get_playlist_audio_features("", "5zSzru2LrIR0o8SUyLelyd")

sebas <- sebas %>%
  filter(!is.na(key))

seb2017 <- sebas %>%
  filter(grepl('2017', added_at))

seb2018 <- sebas %>%
  filter(grepl('2018', added_at))

seb2019 <- sebas %>%
  filter(grepl('2019', added_at))

seb2020 <- sebas %>%
  filter(grepl('2020', added_at))


seventotwenty <-
  bind_rows(
    seb2017 %>% mutate(category = "2017"),
    seb2018 %>% mutate(category = "2018"),
    seb2019 %>% mutate(category = "2019"),
    seb2020 %>% mutate(category = "2020")
  )


# months
seb1708 <- sebas %>%
  filter(grepl('2017-08', added_at))

seb1709 <- sebas %>%
  filter(grepl('2017-09', added_at))

seb1710 <- sebas %>%
  filter(grepl('2017-10', added_at))

seb1711 <- sebas %>%
  filter(grepl('2017-11', added_at))

seb1712 <- sebas %>%
  filter(grepl('2017-12', added_at))

months_2017 <-
  bind_rows(
    seb1709 %>% mutate(category = "September 2017"),
    seb1710 %>% mutate(category = "October 2017"),
    seb1711 %>% mutate(category = "November 2017"),
    seb1712 %>% mutate(category = "December 2017")
  )


keyfreqyear <- seventotwenty %>%
ggplot(aes(x = factor(key_name), fill = category)) +
  geom_bar() +
  xlab("Keys (factored)") +
  ylab("Frequency")+
  ggtitle("Key frequency all tracks/ tracks per year")

modefreqyear <- seventotwenty %>%
  ggplot(aes(x = factor(mode), fill = category)) +
  geom_bar() +
  xlab("Mode (factored)") +
  ylab("Frequency")+
  ggtitle("Mode frequency all tracks/ tracks per year") +
  scale_x_discrete(labels=c("0" = "Minor", "1" = "Major"))


valeneryear <- seventotwenty %>%
  ggplot(aes(x = valence, y = energy, fill = category)) +
  geom_point() +
  xlab("Valence") +
  ylab("Energy")+
  ggtitle("Valence vs Energy all tracks/ tracks per year")

valener_2017_m <- months_2017 %>%
  ggplot(aes(x = valence, y = energy, fill = category)) +
  geom_point() +
  xlab("Valence") +
  ylab("Energy")+
  ggtitle("Valence vs Energy September-December/ 2017")




valendancepopyear <- seventotwenty %>%
 ggplot(                          # Set up the plot.
    aes(
      x = valence,
      y = energy,
      size = track.popularity,
      colour = danceability,
      label = track.name           # Labels will be interactively visible.
    )
  ) +
  geom_point() +                   # Scatter plot.
  geom_rug(size = 0.1) +           # Add 'fringes' to show data distribution.
  facet_wrap(~category) +           # Separate charts per country.
  scale_x_continuous(              # Fine-tune the x axis.
    limits = c(0, 1),
    breaks = c(0, 0.50, 1),        # Use grid-lines for quadrants only.
    minor_breaks = NULL            # Remove 'minor' grid-lines.
  ) +
  scale_y_continuous(              # Fine-tune the y axis in the same way.
    limits = c(0, 1),
    breaks = c(0, 0.50, 1),
    minor_breaks = NULL
  ) +
  scale_colour_viridis_c(          # Use the cividis palette
    option = "A",                  # Qualitative set.
    alpha = 0.8,                   # Include some transparency
    guide = "none"
  ) +
  scale_size_continuous(           # Fine-tune the sizes of each point.
    guide = "none"                 # Remove the legend for size.
  ) +
  theme_light() +                  # Use a simpler theme.
  labs(                            # Make the titles nice.
    x = "Valence",
    y = "Energy"
  ) +
  theme(strip.background = element_rect(fill="#660066"))



vdp_2017_m <- months_2017 %>%
  ggplot(                          # Set up the plot.
    aes(
      x = valence,
      y = energy,
      size = track.popularity,
      colour = danceability,
      label = track.name           # Labels will be interactively visible.
    )
  ) +
  geom_point() +                   # Scatter plot.
  geom_rug(size = 0.1) +           # Add 'fringes' to show data distribution.
  facet_wrap(~category) +           # Separate charts per country.
  scale_x_continuous(              # Fine-tune the x axis.
    limits = c(0, 1),
    breaks = c(0, 0.50, 1),        # Use grid-lines for quadrants only.
    minor_breaks = NULL            # Remove 'minor' grid-lines.
  ) +
  scale_y_continuous(              # Fine-tune the y axis in the same way.
    limits = c(0, 1),
    breaks = c(0, 0.50, 1),
    minor_breaks = NULL
  ) +
  scale_colour_viridis_c(          # Use the cividis palette
    option = "A",                  # Qualitative set.
    alpha = 0.8,                   # Include some transparency
    guide = "none"
  ) +
  scale_size_continuous(           # Fine-tune the sizes of each point.
    guide = "none"                 # Remove the legend for size.
  ) +
  theme_light() +                  # Use a simpler theme.
  labs(                            # Make the titles nice.
    x = "Valence",
    y = "Energy"
  ) +
  theme(strip.background = element_rect(fill="#660066"))
  
    
```


### Introduction



#### Corpus: my personal "This is: Sebas" playlist

In 2017 i created a playlist with the idea of adding every song i like to it through the years. Until now i have added 1095 songs to my playlist. It's also important to note that my main source of music is spotify. I've always found that my music taste is kind of variable with a lot of different genre's but i do wonder if there are similarities or patterns to be found in all the music to be able to pinpoint why i like certain music. 


#### Playlist-Wide Research
First i would like to answer some questions about the playlist in general: 
Is there a certain key across all songs that i like particularly?
What is the most frequent modality?
Is the majority of the songs in a certain bpm range? 
How similar is the valence across the playlist?
How high is the energy in the playlist

I suspect key, bpm and modality to be evenly distributed due to all the different genres and valence and energy to be all over the place.

#### Further Research
I would like to expand on researching per year, per season and maybe even per month as i expect to see more interesting things happening in smaller time periods.
Furthermore i'd like to involve genres as that seems like one of the most important things in music taste. Sadly there is no way to do this per track so i might try to take the genres from the albums the songs are coming from.

#### Link to playlist
https://open.spotify.com/playlist/5zSzru2LrIR0o8SUyLelyd?si=G_XxooasSYyhyixlqyRA8Q



### Keys

```{r echo=FALSE, message=FALSE}
ggplotly(keyfreqyear)
```

***

* As you can see the key frequency over the whole playlist is distributed fairly even, however C# and G seem to be the most common with over a hundred songs each and D# the least with only 22 songs. So i conclude that either i really like C# and G and dislike D# or these are just very popular/uncpopular keys in music in general. 

### Modality

```{r echo=FALSE, message=FALSE}
ggplotly(modefreqyear) 
```

***

* As you can see i seem to prefer songs with a major modality this also reflects in the "per year" category.

### Valence

```{r echo=FALSE, message=FALSE}
ggplotly(valeneryear) 
```

***

* As expected the valence and energy are all over the place.

### Graphs

```{r}
ggplotly(valendancepopyear)

ggplotly(vdp_2017_m)

ggplotly(valener_2017_m)

```

### Graphs

```{r}
ggplotly(vdp_2017_m)
```

### Graphs

```{r}
ggplotly(valener_2017_m)
```